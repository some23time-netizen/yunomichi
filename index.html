<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¹¯ã®é“å·¡ç¤¼ï½œ1619.5kmã®æ—…</title>


<style>
body {
  font-family: sans-serif;
  margin: 0;
  padding: 8px;   /* â† 20px ãŒçŠ¯äººã€‚ã¾ãšæ¸›ã‚‰ã™ */
}


h1 {
  margin: 4px 0 8px 0;   /* ä¸Šä¸‹ã®ä½™ç™½ã‚’ã‹ãªã‚Šå‰Šæ¸› */
  font-size: 20px;      /* å¤§ãã™ããªã„ */
  text-align: center;
}


.title {
  text-align: center;
  margin: 2px 0 4px;   /* â† ã»ã¼æœ€å° */
}


.title img {
  display: block;        /* â† ã“ã“ãŒæœ€é‡è¦ï¼ˆinline-block ã¯ä½¿ã‚ãªã„ï¼‰ */
  margin: 0 auto;        /* ä¸­å¤®å¯„ã› */
  max-width: 200px;
  width: 100%;
  height: auto;
}




/* ===== ãƒãƒƒãƒ— ===== */
.map-wrapper {
position: relative;
width: 100%;
aspect-ratio: 1333 / 417;

}

.map {
width: 100%;
height: 100%;
display: block;
}

/* ===== SVGãƒ«ãƒ¼ãƒˆ ===== */
svg {
position: absolute;
inset: 0;
width: 100%;
height: 100%;
pointer-events: none;
}

#progressPath {
transition: stroke-dashoffset 0.8s ease-out;
}

/* ===== ãƒ”ãƒ³ ===== */
.pin {
position: absolute;
transform: translate(-50%, -100%);
pointer-events: none;
}

/* èµ¤ãƒ”ãƒ³ï¼ˆpin.pngï¼‰ã ã‘å°ã•ã„ */
.pin-small {
width: 16px;
opacity: 1;
}

/* ===== èµ¤ãƒ”ãƒ³ã ã‘æ“ä½œå¯èƒ½ã«ã™ã‚‹ ===== */
.pin-small {
  pointer-events: auto;
}


/* ===== èµ¤ãƒ”ãƒ³æ¡ˆå†…ï¼ˆhover / tapï¼‰ ===== */
.pin-small::after {
  content: attr(data-label);
  position: absolute;
  bottom: 110%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.75);
  color: #fff;
  font-size: 11px;
  padding: 4px 6px;
  border-radius: 6px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
}

.pin-small:hover::after,
.pin-small:focus::after {
  opacity: 1;
}

/* é“å¾Œãƒ»ä¼Šå‹¢ãƒ»ãƒ•ã‚§ãƒªãƒ¼ãƒ»ã‚´ãƒ¼ãƒ« */
.pin-large {
width: 26px;
opacity: 1;
}

/* è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆç”¨ */
.hidden {
display: none;
}




/* å¾©å…ƒãƒœã‚¿ãƒ³ã¯æ§ãˆã‚è¡¨ç¤º */
#loadBtn {
  font-size: 12px;
  opacity: 0.7;
}


/* è·é›¢å…¥åŠ›æ¬„ã‚’è¦‹ã‚„ã™ãï¼ˆå³å¯„ã›ï¼‰ */
#inputKm {
  width: 120px;        /* â† æ¨ªå¹…ã¯ãã®ã¾ã¾ */
  height: 40px;
  font-size: 16px;
  padding: 4px 6px;
  text-align: right;   /* â† ã‚«ãƒ¼ã‚½ãƒ«ã‚’å³ç«¯ã« */
}

.history {
margin-top: 10px;
font-size: 14px;
}

.history table {
width: 100%;
border-collapse: collapse;
margin-top: 8px;
font-size: 14px;
}

.history th,
.history td {
border: 1px solid #ccc;
padding: 4px 6px;
text-align: left;
}

.history th {
background: #f5f5f5;
}

.history th:first-child,
.history td:first-child {
text-align: center;
}

/* ===== å±¥æ­´ï¼šè¦‹å‡ºã—ã¯ä¸­å¤®æƒãˆ ===== */
.history th {
  text-align: center;
  vertical-align: middle;
}

.history td {
vertical-align: middle;
}

.history button {
padding: 2px 6px;
font-size: 12px;
cursor: pointer;
}

/* ===== å±¥æ­´ï¼šæ—¥ä»˜ï¼ˆ2è¡Œãƒ»å¼·å¼±ã‚ã‚Šï¼‰ ===== */
.history-date {
  text-align: center;
  line-height: 1.2;
}

.history-date .date-main {
  font-size: 16px;      /* â† ä¸»å½¹ï¼š2æœˆ4æ—¥ */
}

.history-date .date-sub {
  font-size: 11px;      /* â† è„‡å½¹ï¼šå¹´ãƒ»æ™‚åˆ» */
  color: #666;
}

.history-date .date-year {
  font-size: 10px;
  color: #999;
}

.milestone {
  position: absolute;
  width: 50px;
  transform: translate(-50%, -120%);
  opacity: 1;
  pointer-events: none;
  transition: opacity 0.6s ease;
  z-index: 20;
}


.milestone.active {
  opacity: 1;
}

/* ===== milestone message ===== */
.milestone-message {
  position: absolute;
  top: 70%;

  left: 12px;      /* â† å·¦å´ã«è¡¨ç¤º */
  right: auto;     /* â† å³æŒ‡å®šã‚’ç„¡åŠ¹åŒ– */

  background: #ffe6ee;
  padding: 14px 18px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  color: #000;
  font-size: 14px;
  line-height: 1.5;
  text-align: left;
  display: inline-block;
  max-width: 90%;
  z-index: 50;
  opacity: 0;
  transition: opacity 0.6s ease;
}



.milestone-message {
  pointer-events: none;   /* â† éè¡¨ç¤ºæ™‚ã¯ã‚¯ãƒªãƒƒã‚¯ã‚’é‚ªé­”ã—ãªã„ */
}

.milestone-message.show {
  pointer-events: auto;   /* â† è¡¨ç¤ºä¸­ã ã‘æ“ä½œå¯èƒ½ */
}


.milestone-message.show {
  opacity: 1;
}

#pointDetail {
  position: absolute;          /* â† fixed ã‚’ã‚„ã‚ã‚‹ */
  left: 50%;
  transform: translateX(-50%); /* â† ç¸¦ã¯JSã§åˆ¶å¾¡ */

  width: 94%;
  max-width: 360px;

  background: #ffe6ee;
  padding: 16px;
  border-radius: 14px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);

  color: #000;
  font-size: 14px;
  line-height: 1.6;
  text-align: left;

  z-index: 1000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

#pointDetail.show {
  opacity: 1;
}


/* ===== ğŸ“± ã‚¹ãƒãƒ›ã ã‘æŒ™å‹•ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ ===== */
@media (max-width: 600px) {
  #pointDetail {
    position: absolute;
    transform: translate(-50%, -50%);
  }
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‹Ã—ï¼‰ */
#pointDetail .point-detail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

#pointDetail .point-detail-header strong {
  font-size: 16px;
}

/* Ã—ãƒœã‚¿ãƒ³ */
#pointDetail .point-detail-close {
  border: none;
  background: none;
  font-size: 20px;
  cursor: pointer;
}

/* ç”»åƒ */
#pointDetail .point-detail-image {
  display: block;
  width: 100%;
  max-width: 140px;        /* â† ãƒãƒƒãƒ†ãƒ«ãƒ¢ãƒ³åŸºæº– */
  margin: 8px auto;
  border-radius: 10px;
}

/* ãƒ†ã‚­ã‚¹ãƒˆ */
#pointDetail .point-detail-text {
  margin-top: 6px;
}



/* ===== ã‚¹ãƒãƒ›æœ€é©åŒ– ===== */
@media (max-width: 600px) {

  /* ç”»é¢ä½™ç™½ã‚’æ¶ˆã™ â†’ åœ°å›³ã‚’æ¨ªã„ã£ã±ã„ã« */
  body {
    padding: 0;
    overflow-x: hidden;
  }

  .map-wrapper {
    width: 100vw;                 /* ç”»é¢å¹…ã„ã£ã±ã„ */
    max-width: none;              /* PCç”¨åˆ¶é™ã‚’è§£é™¤ */
    margin-left: 50%;
    transform: translateX(-50%);  /* å®Œå…¨ä¸­å¤®å¯„ã› */
  }

  /* ===== æ“ä½œãƒœã‚¿ãƒ³è¡Œ ===== */

  /* è¡Œã¯å·¦åŸºæº– */
  .controls-row {
    justify-content: flex-start;
  }

  /* æ“ä½œã‚¨ãƒªã‚¢ */
  .controls-right {
    display: flex;
    flex-wrap: nowrap;
    align-items: center;
    width: 100%;
    max-width: 360px;
    padding-left: 12px;
    padding-right: 0;
    gap: 10px;
  }

  /* å…¥åŠ›æ¬„ */
  #inputKm {
    width: 120px;
    height: 44px;
    font-size: 18px;
  }

  /* ===== æ“ä½œãƒœã‚¿ãƒ³ è¦‹ãŸç›®ã‚’å®Œå…¨çµ±ä¸€ ===== */
  #addBtn,
  #saveBtn,
  #loadBtn {
    font-size: 14px;
    padding: 6px 10px;
    color: #000;
    background: #f5f5f5;   /* è–„ã„ã‚°ãƒ¬ãƒ¼ */
    border: 1px solid #999;
    border-radius: 6px;
    white-space: nowrap;
  }

  /* ===== ã‚¿ã‚¤ãƒˆãƒ« ===== */
  h1 {
    margin: 16px 0;
    text-align: center;
  }

  /* ===== milestone ===== */
  .milestone {
    width: 28px;
    transform: translate(-50%, -60%);
  }

  /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
  .milestone-message {
    top: 78%;
    font-size: 13px;
    padding: 12px 14px;
  }

  /* ===== å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ« ===== */
  .history table {
    table-layout: fixed;
    width: 100%;
  }

.history th:nth-child(1),
.history td:nth-child(1) {
  width: 32px;
}

.history th:nth-child(2),
.history td:nth-child(2) {
  width: 70px;
  white-space: nowrap;
}


/* ===== å±¥æ­´ï¼šãƒ˜ãƒƒãƒ€ãƒ¼æ–‡å­—ã‚µã‚¤ã‚ºçµ±ä¸€ ===== */
.history th {
  font-size: 13px;        /* å…¨é …ç›®åŒã˜ã‚µã‚¤ã‚º */
  font-weight: normal;    /* å¤ªã•ã‚‚çµ±ä¸€ */
  white-space: nowrap;    /* æ”¹è¡Œã•ã›ãªã„ */
}


/* ===== å±¥æ­´ï¼šè·é›¢kmãƒ»åˆè¨ˆkmï¼ˆæ•°å€¤åˆ—ï¼‰ ===== */
.history th:nth-child(3),
.history td:nth-child(3),
.history th:nth-child(4),
.history td:nth-child(4) {
  width: 64px;              /* â† å°‘ã—ç´°ã */
  font-size: 15px;
  text-align: right;        /* æ•°å­—ã¯å³æƒãˆ */
  font-variant-numeric: tabular-nums;
}

/* ===== å±¥æ­´ï¼šé€šéãƒã‚¤ãƒ³ãƒˆ ===== */
.history th:nth-child(5),
.history td:nth-child(5) {
  width: auto;              /* â† æœ€å¤§é™ä½¿ã† */
  font-size: 14px;          /* â† 12 â†’ 14 ã§èª­ã¿ã‚„ã™ã */
  line-height: 1.5;
  white-space: normal;
  word-break: break-word;
  vertical-align: middle;
}

  /* å‰Šé™¤ãƒœã‚¿ãƒ³ */
  .history th:nth-child(6),
  .history td:nth-child(6) {
    width: 44px;
  }

/* ===== å±¥æ­´ï¼šè¦‹å‡ºã—ã®æ”¹è¡Œã‚’é˜²ã ===== */
.history th:nth-child(5) {
  white-space: nowrap;   /* ã€Œé€šéãƒã‚¤ãƒ³ãƒˆã€ã‚’1è¡Œã« */
}

/* Noåˆ—ã‚’å°‘ã—ã ã‘ç´°ãã™ã‚‹ */
.history th:nth-child(1),
.history td:nth-child(1) {
  width: 24px;
}

  /* ===== ãƒ”ãƒ³ã‚µã‚¤ã‚º ===== */
  .pin-small { width: 12px; }
  img[src*="ship"] { width: 20px; }
  .pin-start,
  .pin-goal,
  img[src*="ise"] { width: 24px; }


}  /* â† â˜… @media ã¯ã“ã“ã§çµ‚äº† */






/* ===== å±¥æ­´ï¼šæ•°å€¤åˆ—ï¼ˆè·é›¢ãƒ»åˆè¨ˆï¼‰ ===== */
.history td:nth-child(3),
.history td:nth-child(4) {
  text-align: right;
  font-size: 16px;
  font-variant-numeric: tabular-nums;
  font-feature-settings: "tnum" 1;
}



/* æœªé”ï¼šåŠé€æ˜ï¼ˆæ¡ˆå†…ã¯CSSã§å‡ºã•ãªã„ã ã‘ï¼‰ */
.pin-small.is-not-reached {
  opacity: 0.35;
}

/* åˆ°é”ï¼šä¸é€æ˜ */
.pin-small.is-reached {
  opacity: 1;
}


/* ===== ğŸ’¡ãƒ˜ãƒ«ãƒ—ï¼ˆæ–‡å­—ã ã‘ï¼‰ ===== */
.help-btn {
  font-size: 16px;
  padding: 0;
  border: none;
  background: none;
  cursor: pointer;
  opacity: 0.7;
}
.help-btn:hover {
  opacity: 1;
}

/* ===== å±¥æ­´ä¸‹ã®å¾©å…ƒã‚¨ãƒªã‚¢ ===== */
.history-footer {
  margin-top: 8px;
  text-align: right;
}

/* ===== æ“ä½œãƒœã‚¿ãƒ³ä½ç½®èª¿æ•´ï¼ˆæœ€çµ‚ãƒ»å³ç«¯å®Œå…¨ä¸€è‡´ï¼‰===== */
.controls {
  margin-top: 16px;
}

.controls-row {
  display: flex;
  justify-content: flex-end;
}

/* â˜… å³ç«¯ã®åŸºæº–ï¼ˆã“ã“ã ã‘ãŒé‡è¦ï¼‰ */
.controls-right {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 200px;
  justify-content: flex-end;
}

.controls-sub {
  margin-top: 6px;
}

.controls-spacer {
  display: inline-block;
  width: 3em;   /* å…¨è§’1æ–‡å­—åˆ† */
}

/* å±¥æ­´ï¼šé€šéãƒã‚¤ãƒ³ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«è¦‹ã›ã‚‹ */
  .passed-point {
    cursor: pointer;
    text-decoration: underline;
  }

/* ===== å±¥æ­´ï¼šæ–‡å­—ç³»ï¼ˆNo / æ—¥ä»˜ / é€šé / å‰Šé™¤ï¼‰ ===== */
.history td:nth-child(1),  /* No */
.history td:nth-child(2),  /* æ—¥ä»˜ */
.history td:nth-child(5),  /* é€šéãƒã‚¤ãƒ³ãƒˆ */
.history td:nth-child(6) { /* å‰Šé™¤ */
  font-size: 14px;
  font-weight: normal;
  font-variant-numeric: normal;
}


/* ===== ğŸ“· é€šéãƒã‚¤ãƒ³ãƒˆè©³ç´°ï¼šé–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ ===== */

.point-detail-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

.point-detail-close {
  border: none;
  background: none;
  font-size: 20px;
  line-height: 1;
  cursor: pointer;
  padding: 0 4px;
  opacity: 0.6;
}

.point-detail-close:hover {
  opacity: 1;
}

.point-detail-text {
  line-height: 1.5;
}

</style>
</head>

<body>

<div class="title">
  <img src="title.png" alt="æ¹¯ã®é“å·¡ç¤¼ 1619.5kmã®æ—…">
</div>


<div class="map-wrapper">

<img src="map.png" class="map" alt="åœ°å›³">

<svg viewBox="0 0 1333 417" xmlns="http://www.w3.org/2000/svg">
<!-- ã‚°ãƒ¬ãƒ¼ãƒ«ãƒ¼ãƒˆï¼ˆdã‚’è²¼ã‚‹ï¼‰ -->
<path
d="m 445.82468,231.88404 -38.64734,31.74603 -67.63285,38.64734 -42.78812,2.76053 -6.90132,15.18288 -70.39337,6.90131 -66.25258,-70.39337
v -9.66183
L 59.351273,248.44719 6.9013108,209.79985 45.548651,176.67356
h 64.872319
l 19.32367,-69.01311 24.84472,1.38026 27.60525,6.90131
v 28.98551
l 9.66183,19.32367 31.74603,11.0421 22.0842,8.28157 30.36576,2.76052 19.32367,-5.52105 16.56315,-16.56314 11.0421,-8.28158 17.9434,-5.52104 9.66184,-15.18289 19.32367,-13.80262 27.60524,-5.52105 31.74603,4.14079 24.84472,6.90131 15.18289,11.0421 13.80262,5.52105 9.66183,-2.76053 26.22498,-15.18288 11.0421,-2.76053 17.94341,-5.52105 15.18288,-9.66183 15.18289,-5.52105 24.84472,-1.38026 12.42236,-2.760526 6.90131,-12.42236 13.80262,-11.042097 15.18288,-12.42236 27.60525,1.380263 97.99861,1.380262 89.71704,-2.760525 12.42236,9.661836 20.70393,9.661835 26.22498,6.901311 34.50656,-4.140787 12.42236,11.042097 20.70393,6.901311 22.08424,-17.943408 23.4644,-1.380262 16.5632,8.281573 30.3657,-12.42236 37.2671,-17.943408 26.225,23.464457 33.1263,12.42236 23.4644,11.042098 16.5632,22.08419 11.0421,24.84472 20.7039,33.12629 11.0421,9.66184 30.3658,4.14079 15.1829,1.38026 5.521,20.70393 -4.1408,12.42236 -8.2816,9.66184 -19.3236,2.76052
h -40.0276
v -16.56315
l -16.5632,-2.76052 -16.5631,23.46446 -19.3237,6.90131 -49.6894,-56.59075 -1.3803,-19.32367 -28.9855,31.74603 -5.521,6.90131
h -30.3658
l -20.7039,15.18288 -35.8869,4.14079 -13.8026,-20.70393 -51.06968,-1.38027 -9.66184,9.66184
h -92.47756
l -5.52105,8.28157 -41.40787,2.76053 -15.18288,-22.0842 -9.66183,8.28158 -16.56315,20.70393 -8.28157,5.52105 -13.80262,-4.14079 -38.64735,-45.54865 -35.88681,-11.0421 -24.84472,-35.88682
h -11.0421
l -8.28157,9.66184 -4.14079,42.78813 2.76053,20.70393 -9.66184,20.70393 -13.80262,12.42236 -20.70393,-11.0421 -8.28158,-13.80262 -53.83022,2.76053 -30.36577,-4.14079 -8.28157,12.42236 -22.0842,-1.38026 -9.66183,-15.18289"
fill="none"
stroke="#6e6d6d"
stroke-width="10"
stroke-linecap="round"
stroke-linejoin="round"
/>

<!-- é»„è‰²ãƒ«ãƒ¼ãƒˆï¼ˆåŒã˜ d ã‚’è²¼ã‚‹ï¼‰ -->
<path
id="progressPath"
d="m 445.82468,231.88404 -38.64734,31.74603 -67.63285,38.64734 -42.78812,2.76053 -6.90132,15.18288 -70.39337,6.90131 -66.25258,-70.39337
v -9.66183
L 59.351273,248.44719 6.9013108,209.79985 45.548651,176.67356
h 64.872319
l 19.32367,-69.01311 24.84472,1.38026 27.60525,6.90131
v 28.98551
l 9.66183,19.32367 31.74603,11.0421 22.0842,8.28157 30.36576,2.76052 19.32367,-5.52105 16.56315,-16.56314 11.0421,-8.28158 17.9434,-5.52104 9.66184,-15.18289 19.32367,-13.80262 27.60524,-5.52105 31.74603,4.14079 24.84472,6.90131 15.18289,11.0421 13.80262,5.52105 9.66183,-2.76053 26.22498,-15.18288 11.0421,-2.76053 17.94341,-5.52105 15.18288,-9.66183 15.18289,-5.52105 24.84472,-1.38026 12.42236,-2.760526 6.90131,-12.42236 13.80262,-11.042097 15.18288,-12.42236 27.60525,1.380263 97.99861,1.380262 89.71704,-2.760525 12.42236,9.661836 20.70393,9.661835 26.22498,6.901311 34.50656,-4.140787 12.42236,11.042097 20.70393,6.901311 22.08424,-17.943408 23.4644,-1.380262 16.5632,8.281573 30.3657,-12.42236 37.2671,-17.943408 26.225,23.464457 33.1263,12.42236 23.4644,11.042098 16.5632,22.08419 11.0421,24.84472 20.7039,33.12629 11.0421,9.66184 30.3658,4.14079 15.1829,1.38026 5.521,20.70393 -4.1408,12.42236 -8.2816,9.66184 -19.3236,2.76052
h -40.0276
v -16.56315
l -16.5632,-2.76052 -16.5631,23.46446 -19.3237,6.90131 -49.6894,-56.59075 -1.3803,-19.32367 -28.9855,31.74603 -5.521,6.90131
h -30.3658
l -20.7039,15.18288 -35.8869,4.14079 -13.8026,-20.70393 -51.06968,-1.38027 -9.66184,9.66184
h -92.47756
l -5.52105,8.28157 -41.40787,2.76053 -15.18288,-22.0842 -9.66183,8.28158 -16.56315,20.70393 -8.28157,5.52105 -13.80262,-4.14079 -38.64735,-45.54865 -35.88681,-11.0421 -24.84472,-35.88682
h -11.0421
l -8.28157,9.66184 -4.14079,42.78813 2.76053,20.70393 -9.66184,20.70393 -13.80262,12.42236 -20.70393,-11.0421 -8.28158,-13.80262 -53.83022,2.76053 -30.36577,-4.14079 -8.28157,12.42236 -22.0842,-1.38026 -9.66183,-15.18289"
fill="none"
stroke="#fabc02"
stroke-width="14"
stroke-linecap="round"
stroke-linejoin="round"
/>
</svg>


<div id="milestoneMessage" class="milestone-message"></div>

<div id="pointDetail" class="hidden"></div>


<!-- é“å¾Œæ¸©æ³‰ï¼šã‚¹ã‚¿ãƒ¼ãƒˆ -->
<img src="onsen.png"
class="pin pin-start"
style="left:33.30%; top:56.55%;">

<!-- é“å¾Œæ¸©æ³‰ï¼šã‚´ãƒ¼ãƒ« -->
<img src="goal.png"
class="pin pin-goal hidden"
style="left:33.30%; top:56.55%;">

</div>

<div class="controls">

  <div class="controls-row">
    <div class="controls-right">
      <input
        type="number"
        id="inputKm"
        step="0.01"
        placeholder="æ­©ã„ãŸè·é›¢km"
      >
      <button id="addBtn">è¿½åŠ </button>
      <span class="controls-spacer"></span> <!-- â˜…è¿½åŠ  -->
    </div>
  </div>

  <div class="controls-row controls-sub">
  <div class="controls-right">
    <button id="saveBtn">ä¿å­˜</button>
   <button class="help-btn" data-help="save">ğŸ’¡</button>
  </div>
</div>

</div>


<div class="history">
<strong>å±¥æ­´</strong>
<table id="historyTable">

<thead>
<tr>
  <th>No</th>
  <th>æ—¥ä»˜</th>
  <th>è·é›¢km</th>
  <th>åˆè¨ˆkm</th>
  <th>é€šéãƒã‚¤ãƒ³ãƒˆ</th>
  <th>å‰Šé™¤</th>
</tr>
</thead>


<tbody>
</tbody>
</table>
</div>

<div class="history-footer">  
  <button id="loadBtn">å¾©å…ƒ</button>
 <button class="help-btn" data-help="load">ğŸ’¡</button>
</div>

<!-- â˜… è¦‹ãˆãªã„ã‘ã©å¿…é ˆã€‚ã©ã“ã§ã‚‚ã„ã„ã®ã§ body å†…ã«æ®‹ã™ -->
<input type="file" id="loadInput" accept=".json" style="display:none">


<script>

const points = [
  { name: "ä½è³€é–¢æ¸¯", x: 19.20, y: 82.91, icon: "ship.png", km: 80 },
  { name: "æƒ³å¤«æ‹", x: 12.20, y: 65.98, icon: "pin.png", km: 160 },
  { name: "å¤ªå®°åºœå¤©æº€å®®", x: 3.10, y: 57.51, icon: "pin.png", km: 240 },
  { name: "ç„¼ãã‚«ãƒ¬ãƒ¼ï¼ˆé–€å¸æ¸¯ï¼‰", x: 8.10, y: 41.53, icon: "pin.png", km: 320 },
  { name: "æ˜çŸ³æµ·å³¡å¤§æ©‹å¡”é ‚ä½“é¨“", x: 69.20, y: 21.41, icon: "pin.png", km: 800 },
  { name: "ä¿¡æ¥½ç„¼é™¶èŠ¸ã‚»ãƒ³ã‚¿ãƒ¼", x: 88.10, y: 20.77, icon: "pin.png", km: 960 },
  { name: "æ¾é˜ªç‰›", x: 92.60, y: 41.53, icon: "pin.png", km: 1020 },
  { name: "ä¼Šå‹¢ç¥å®®", x: 96.20, y: 49.84, icon: "ise.png" },
  { name: "å¿—æ‘©åœ°ä¸­æµ·æ‘ï¼ˆå®¿æ³Šï¼‰", x: 97.00, y: 62.30, icon: "pin.png", km: 1100 },
  { name: "çŒŸå¸«ã®å¤©ç„¶ã‚¸ãƒ“ã‚¨ ã„ã¨ã†", x: 91.20, y: 59.11, icon: "pin.png", km: 1160 },
  { name: "æŸ¿ã®è‘‰ã™ã—", x: 80.10, y: 54.31, icon: "pin.png", km: 1280 },
  { name: "é«˜é‡å±±å¥¥ä¹‹é™¢", x: 77.40, y: 59.11, icon: "pin.png", km: 1300 },
  { name: "å¾³å³¶æ¸¯", x: 67.10, y: 60.11, icon: "ship.png", km: 1360 },
  { name: "é‡‘åˆ€æ¯”ç¾…å®®", x: 49.80, y: 46.01, icon: "pin.png", km: 1440 },
  { name: "å±±ä¸ŠéŠ€æåœ’", x: 42.70, y: 57.51, icon: "pin.png", km: 1540 }
];

// ================================
// ğŸ“· é€šéãƒã‚¤ãƒ³ãƒˆï¼ˆç”»åƒã‚ã‚Šï¼‰å®šç¾©
// ================================

const POINTS_WITH_IMAGE = [
  "ãƒãƒƒãƒ†ãƒ«ãƒ¢ãƒ³",
  "ã‚«ãƒƒãƒ‘ã®çŸ³åƒ",
  "ãŠãƒãƒ³ãƒ—æ§˜",
  "ç™½ç‹ã®æ¹¯ç”°æ¸©æ³‰è¶³æ¹¯",
  "å’Œå°šé¯°",
  "ã‚ºãƒƒã‚³ã‚±ä¸‰äººçµ„ãƒ¢ãƒ‹ãƒ¥ãƒ¡ãƒ³ãƒˆ",
  "ã‚ã‚ŠãŒã¨ã†åƒ",
  "ç¾©å£«ã‚ã‚“ã©ã‚“ï¼ˆã‹ã‚‰ãã‚Šæ™‚è¨ˆï¼‰",
  "ç«‹æœ¨éŸ³æ¥½å ‚ï¼ˆã‚«ãƒ•ã‚§ï¼‰",
  "ã—ã‚‰ã•ãé‹å‹•å…¬åœ’",
  "é³¥ç¾½æ°´æ—é¤¨ï¼ˆãƒ©ãƒƒã‚³ã®ãƒ¡ã‚¤ã¡ã‚ƒã‚“ï¼‰",
  "ã‚¤ãƒãƒ§ã‚¦ä¸¦æœ¨ï¼ˆå¤§å°ç”ºå°æ»ï¼‰",
  "ç¿ æ³¢æ©‹"
];


const POINT_DETAILS = {
  "ãƒãƒƒãƒ†ãƒ«ãƒ¢ãƒ³": {
    title: "ãƒãƒƒãƒ†ãƒ«ãƒ¢ãƒ³",
    img: "mattelmon.png",
    text: `
      ã‹ã¤ã¦ã®ãƒ•ã‚§ãƒªãƒ¼ã®è¨˜æ†¶ã‚’æ®‹ã™ã€èµ¤ã„å¯å‹•æ©‹ã®ãã°ã€‚<br>
      ãƒãƒƒãƒ†ãƒ«ãƒ¢ãƒ³ãŒã€é™ã‹ã«æ—…äººã‚’å¾…ã£ã¦ã„ã¾ã™ã€‚
    `,
    autoClose: null
  },

  "ã‚«ãƒƒãƒ‘ã®çŸ³åƒ": {
    title: "ã‚«ãƒƒãƒ‘ã®çŸ³åƒ",
    img: "kappa.png",
    text: `
      ä¸æ€è­°ãªã‚«ãƒƒãƒ‘ã®çŸ³åƒã«å‡ºä¼šã„ã¾ã—ãŸã€‚<br>
      æ€ã‚ãšåŠ›ãŒæŠœã‘ã‚‹ã€æ—…ã®é€”ä¸­ã®å°ã•ãªå‡ºæ¥äº‹ã§ã™ã€‚
    `,
    autoClose: null
  },

  "ãŠãƒãƒ³ãƒ—æ§˜": {
    title: "ãŠãƒãƒ³ãƒ—æ§˜",
    img: "oponpu.png",
    text: `
      ä¸æ€è­°ãªå­˜åœ¨ã«è¦‹å®ˆã‚‰ã‚ŒãªãŒã‚‰ã€‚<br>
      ä»Šæ—¥ã‚‚æ·¡ã€…ã¨ã€ã§ã‚‚ç¢ºå®Ÿã«ã€‚
    `,
    autoClose: null
  },

  "ç™½ç‹ã®æ¹¯ç”°æ¸©æ³‰è¶³æ¹¯": {
    title: "ç™½ç‹ã®æ¹¯ç”°æ¸©æ³‰è¶³æ¹¯",
    img: "shirofox.png",
    text: `
      è¶³æ¹¯ã«è…°ã‚’ä¸‹ã‚ã™ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã€‚<br>
      ä»Šæ—¥ã®ç–²ã‚ŒãŒã€å°‘ã—ãšã¤æŠœã‘ã¦ã„ãã¾ã™ã€‚
    `,
    autoClose: null
  },

  "å’Œå°šé¯°": {
    title: "å’Œå°šé¯°",
    img: "namazu.png",
    text: `
      æ€ã‚ãšäºŒåº¦è¦‹ã—ã¦ã—ã¾ã†å­˜åœ¨ã€‚<br>
      æ—…ã«ã¯ã€ã“ã‚“ãªå‡ºä¼šã„ã‚‚ã‚ã‚Šã¾ã™ã€‚
    `,
    autoClose: null
  },

  "ã‚ºãƒƒã‚³ã‚±ä¸‰äººçµ„ãƒ¢ãƒ‹ãƒ¥ãƒ¡ãƒ³ãƒˆ": {
    title: "ã‚ºãƒƒã‚³ã‚±ä¸‰äººçµ„ãƒ¢ãƒ‹ãƒ¥ãƒ¡ãƒ³ãƒˆ",
    img: "zukkoke.png",
    text: `
      æ‡ã‹ã—ã„æ°—é…ã«ã€æ€ã‚ãšå£å…ƒãŒç·©ã¿ã¾ã™ã€‚<br>
      å°‘ã—è»½ã‚„ã‹ãªä¸€æ—¥ã§ã™ã€‚
    `,
    autoClose: null
  },

  "ã‚ã‚ŠãŒã¨ã†åƒ": {
    title: "ã‚ã‚ŠãŒã¨ã†åƒ",
    img: "arigato.png",
    text: `
      çŸ­ã„è¨€è‘‰ã«ã€å°‘ã—èƒŒä¸­ã‚’æŠ¼ã•ã‚Œã¾ã™ã€‚<br>
      ä»Šæ—¥ã‚‚ä¸€æ­©ãšã¤ã€‚
    `,
    autoClose: null
  },

  "ç¾©å£«ã‚ã‚“ã©ã‚“ï¼ˆã‹ã‚‰ãã‚Šæ™‚è¨ˆï¼‰": {
    title: "ç¾©å£«ã‚ã‚“ã©ã‚“ï¼ˆã‹ã‚‰ãã‚Šæ™‚è¨ˆï¼‰",
    img: "gishi.png",
    text: `
      æ™‚é–“ã«ãªã‚‹ã¨å‹•ãå‡ºã™ã€ã‹ã‚‰ãã‚Šæ™‚è¨ˆã€‚<br>
      å¿ è‡£è”µã®ç”ºã‚‰ã—ã„ã€é™ã‹ãªéŠã³å¿ƒã«å‡ºä¼šã„ã¾ã™ã€‚
    `,
    autoClose: null
  },

  "ç«‹æœ¨éŸ³æ¥½å ‚ï¼ˆã‚«ãƒ•ã‚§ï¼‰": {
    title: "ç«‹æœ¨éŸ³æ¥½å ‚ï¼ˆã‚«ãƒ•ã‚§ï¼‰",
    img: "tachiki.png",
    text: `
      éŸ³æ¥½å ‚ã¨ã„ã†åå‰ã®ã€é™ã‹ãªã‚«ãƒ•ã‚§ã€‚<br>
      ã²ã¨æ¯ã¤ãã ã‘ã§ã€æ°—åˆ†ãŒå°‘ã—æ•´ã„ã¾ã™ã€‚
    `,
    autoClose: null
  },

  "ã—ã‚‰ã•ãé‹å‹•å…¬åœ’": {
    title: "ã—ã‚‰ã•ãé‹å‹•å…¬åœ’",
    img: "karakuri.png",
    text: `
      ã‹ã‚‰ãã‚Šæ™‚è¨ˆã‚’æ¨ªç›®ã«ã€‚<br>
      ä»Šæ—¥ã‚‚å …å®Ÿã«ãƒã‚¤ãƒ³ãƒˆé€šéã€‚
    `,
    autoClose: null
  },

  "é³¥ç¾½æ°´æ—é¤¨ï¼ˆãƒ©ãƒƒã‚³ã®ãƒ¡ã‚¤ã¡ã‚ƒã‚“ï¼‰": {
    title: "é³¥ç¾½æ°´æ—é¤¨ï¼ˆãƒ©ãƒƒã‚³ã®ãƒ¡ã‚¤ã¡ã‚ƒã‚“ï¼‰",
    img: "may.png",
    text: `
      äººæ°—è€…ã«ã€ã¡ã‚‡ã£ã¨å…ƒæ°—ã‚’ã‚‚ã‚‰ã£ã¦ã€‚<br>
      æ—…ã¯ã€ã¾ã ç¶šãã¾ã™ã€‚
    `,
    autoClose: null
  },

  "ã‚¤ãƒãƒ§ã‚¦ä¸¦æœ¨ï¼ˆå¤§å°ç”ºå°æ»ï¼‰": {
    title: "ã‚¤ãƒãƒ§ã‚¦ä¸¦æœ¨ï¼ˆå¤§å°ç”ºå°æ»ï¼‰",
    img: "icyo.png",
    text: `
      ã¾ã£ã™ãã«ç¶šãä¸¦æœ¨é“ã€‚<br>
      æ­©ããƒªã‚ºãƒ ã¨ã€æ™¯è‰²ãŒé‡ãªã‚Šã¾ã™ã€‚
    `,
    autoClose: null
  },

  "ç¿ æ³¢æ©‹": {
    title: "ç¿ æ³¢æ©‹",
    img: "suiha.png",
    text: `
      æ©‹ã®ä¸Šã§æ·±å‘¼å¸ã€‚<br>
      å·ã®æµã‚ŒãŒã€æ­©ãç¶šã‘ãŸæ™‚é–“ã‚’æ˜ ã—ã¦ã„ã¾ã™ã€‚
    `,
    autoClose: null
  }
};





const GOAL_KM = 1619.5;

const routeSegments = [
  // é“å¾Œ â†’ ä½è³€é–¢æ¸¯
  { kmStart: 0,    kmEnd: 80,   ratioStart: 0.00, ratioEnd: 0.06 },

  // ä½è³€é–¢æ¸¯ â†’ æƒ³å¤«æ‹
  { kmStart: 80,   kmEnd: 160,  ratioStart: 0.06, ratioEnd: 0.105 },

  // æƒ³å¤«æ‹ â†’ é–€å¸æ¸¯ï¼ˆã‚¢ãƒ³ã‚«ãƒ¼åŒºé–“ï¼‰
  { kmStart: 160,  kmEnd: 320,  ratioStart: 0.105, ratioEnd: 0.195 },

  // â˜… é–€å¸æ¸¯ â†’ æ˜çŸ³ï¼ˆwateråŒºé–“ãƒ»ã¾ã¨ã‚ï¼‰
  { kmStart: 320,  kmEnd: 800,  ratioStart: 0.195, ratioEnd: 0.495 },

  // æ˜çŸ³ â†’ ä¼Šå‹¢ç¥å®®ï¼ˆã‚¢ãƒ³ã‚«ãƒ¼åŒºé–“ï¼‰
  { kmStart: 800,  kmEnd: 1050, ratioStart: 0.495, ratioEnd: 0.625 },

  // ä¼Šå‹¢ç¥å®® â†’ ä¸­é–“ç‚¹ï¼ˆä½“æ„Ÿè£œæ­£ï¼‰
  { kmStart: 1050, kmEnd: 1200, ratioStart: 0.625, ratioEnd: 0.70 },

  // ä¸­é–“ç‚¹ â†’ é«˜é‡å±±
  { kmStart: 1200, kmEnd: 1300, ratioStart: 0.70, ratioEnd: 0.76 },

  // é«˜é‡å±± â†’ å¾³å³¶æ¸¯
  { kmStart: 1300, kmEnd: 1360, ratioStart: 0.76, ratioEnd: 0.82 },

  // å¾³å³¶æ¸¯ â†’ é‡‘æ¯˜ç¾…å®®
  { kmStart: 1360, kmEnd: 1440, ratioStart: 0.82, ratioEnd: 0.90 },

  // é‡‘æ¯˜ç¾…å®® â†’ å±±ä¸ŠéŠ€æåœ’ï¼ˆã‚´ãƒ¼ãƒ«å‰ï¼‰
  { kmStart: 1440, kmEnd: 1600, ratioStart: 0.90, ratioEnd: 1.00 }
];

const STORAGE_KEY = "yunomichi_history";

const inputKm = document.getElementById("inputKm");
const historyList = document.getElementById("historyList");
const progressPath = document.getElementById("progressPath");

const startPin = document.querySelector(".pin-start");
const goalPin = document.querySelector(".pin-goal");

let history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

function totalKm() {
return history.reduce((sum, h) => sum + h.km, 0);
}

function kmToRatio(actualKm) {
  const km = Math.min(actualKm, GOAL_KM);

  const seg = routeSegments.find(
    s => km >= s.kmStart && km <= s.kmEnd
  );

  if (!seg) return 1;

  const progress =
    (km - seg.kmStart) / (seg.kmEnd - seg.kmStart);

  return seg.ratioStart +
    (seg.ratioEnd - seg.ratioStart) * progress;
}



function updateRoute() {
  if (!progressPath.getTotalLength) return;

  const length = progressPath.getTotalLength();
  const ratio = kmToRatio(totalKm());

  progressPath.style.strokeDasharray = length;
  progressPath.style.strokeDashoffset =
    length - length * ratio;
}


function updateGoalPin() {
if (totalKm() >= GOAL_KM) {
startPin.classList.add("hidden");
goalPin.classList.remove("hidden");
goalPin.classList.add("reached");
} else {
startPin.classList.remove("hidden");
goalPin.classList.add("hidden");
}
}


function renderHistory() {
const tbody = document.querySelector("#historyTable tbody");
tbody.innerHTML = "";

  const passedPerRow =
    calculatePassedPointsPerRow(history, getAllPassingPoints());

// åˆè¨ˆè·é›¢ã‚’å…ˆã«å…¨éƒ¨è¨ˆç®—
let total = history.reduce((sum, h) => sum + h.km, 0);

// é™é †ï¼ˆæœ€æ–°ãŒä¸Šï¼‰
[...history].reverse().forEach((h, index) => {
const tr = document.createElement("tr");

const d = h.date ? new Date(h.date) : null;

const date = d
  ? `
    <div class="history-date">
      <div class="date-main">
        ${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥
      </div>
      <div class="date-sub">
         ${String(d.getHours()).padStart(2, "0")}:${String(d.getMinutes()).padStart(2, "0")}
        <span class="date-year">ï¼ˆ${d.getFullYear()}ï¼‰</span>
        </div>
    </div>
  `
  : "";


const realIndex = history.length - 1 - index;
const rowPassed = passedPerRow[realIndex] || [];


tr.innerHTML = `
<td>${realIndex + 1}</td>
<td style="text-align:center">${date}</td>
<td>${h.km.toFixed(2)}</td>
<td>${total.toFixed(2)}</td>
<td>
${rowPassed.map(name => {
  if (POINTS_WITH_IMAGE.includes(name)) {
  return `<span
    class="passed-point"
    style="cursor:pointer;"
    onclick="showPointDetail('${name}')"
  >ğŸ“· ${name}</span>`;
} else {
  return `<span>${name}</span>`;
}
}).join("ï¼")}
</td>
<td style="text-align:center">
  <button data-index="${realIndex}">å‰Šé™¤</button>
</td>
`;



tbody.appendChild(tr);
total -= h.km;
});

// å‰Šé™¤ãƒœã‚¿ãƒ³å‡¦ç†
tbody.querySelectorAll("button").forEach(btn => {
btn.addEventListener("click", () => {
const i = Number(btn.dataset.index);
history.splice(i, 1);
save();
events.forEach(e => e._shown = false); // â† â˜… ã“ã‚Œã‚’è¿½åŠ 
updateRoute();
updateGoalPin();
renderHistory();
updateEvents();
});
});

// ğŸ“· é€šéãƒã‚¤ãƒ³ãƒˆï¼ˆç”»åƒã‚ã‚Šï¼‰ã‚¯ãƒªãƒƒã‚¯å‡¦ç† â† â˜…ã“ã“ï¼
tbody.querySelectorAll(".passed-point").forEach(span => {
  span.addEventListener("click", (e) => {
    e.stopPropagation();        // â† çµ¶å¯¾å¿…è¦
    const name = span.dataset.point;
    showPointDetail(name, span);
  });
});

} // â† renderHistory() çµ‚äº†


function createMilestones() {
  const mapWrapper = document.querySelector(".map-wrapper");

  milestones.forEach(m => {
    const img = document.createElement("img");
    img.src = m.icon;
    img.className = "milestone";
    img.style.left = m.x + "%";
    img.style.top = m.y + "%";
    img.title = m.name;

    mapWrapper.appendChild(img);

    m._el = img; // â˜… å¾Œç¶šå‡¦ç†ã§å¿…é ˆ
  });
}


function updateEvents() {
if (!milestones || milestones.length === 0) return;
if (!milestones[0]._el) return;
  const box = document.getElementById("milestoneMessage");
  if (!box) return;

  const total = totalKm();

  // ===== milestone è¡¨ç¤ºåˆ¶å¾¡ =====
  milestones.forEach(m => {
    // åˆæœŸã¯å¿…ãšè–„ã
    m._el.style.opacity = "0.3";

    // åˆ°é”ã—ãŸã‚‚ã®ã ã‘æ¿ƒã
    if (total >= m.km) {
      m._el.style.opacity = "1";
    }
  });

// ===== event message =====
events.forEach(e => {
  if (e._shown) return;

  if (total > 0 && total >= e.distanceKm) {
    const lines = Array.isArray(e.message) ? e.message : [e.message];

    box.innerHTML = `
      <strong>${e.point}</strong><br>
      ${lines.join("<br>")}
    `;

    box.classList.add("show");

    // â˜… æ—¢å­˜ã‚¿ã‚¤ãƒãƒ¼ã‚’å¿…ãšæ­¢ã‚ã‚‹
    clearTimeout(box._eventTimer);

    // â˜… è¡¨ç¤ºæ™‚é–“ï¼ˆã“ã“ã ã‘è§¦ã‚Œã°OKï¼‰
    box._eventTimer = setTimeout(() => {
      box.classList.remove("show");
    }, 9000);   // â† å¥½ããªç§’æ•°ã«ã—ã¦OK

    e._shown = true;
  }
});


// ===== èµ¤ãƒ”ãƒ³ åˆ°é”åˆ¤å®šï¼ˆkmãƒ™ãƒ¼ã‚¹ï¼‰ =====
const totalDistance = totalKm();

points.forEach(p => {
  if (!p._el || p.icon !== "pin.png") return;
  if (typeof p.km !== "number") return;

  const reached = totalDistance >= p.km;

  p._el.classList.toggle("is-reached", reached);
  p._el.classList.toggle("is-not-reached", !reached);
});

}


function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
}


function getAllPoints() {
  // é€šéãƒã‚¤ãƒ³ãƒˆã¯ event.json ã®ã¿ã‚’ä½¿ã†
  return (events || [])
    .map(e => ({
      name: e.point,
      km: Number(e.distanceKm ?? e.km)
    }))
    .filter(p => !isNaN(p.km))
    .sort((a, b) => a.km - b.km);
}


document.getElementById("addBtn").addEventListener("click", () => {
  const km = Number(inputKm.value);
  if (isNaN(km) || km <= 0) return;

  const beforeKm = totalKm();
  const afterKm = beforeKm + km;

history.push({
  km,
  date: new Date().toISOString()
});

save();
events.forEach(e => {
    if (e.distanceKm > beforeKm) {
      e._shown = false;
    }
  });
updateRoute();
updateGoalPin();
renderHistory();
updateEvents();
inputKm.value = "";
});

const mapWrapper = document.querySelector(".map-wrapper");

points.forEach(p => {
  const img = document.createElement("img");
  img.src = p.icon;
  img.className = "pin";

  if (p.icon === "pin.png") {
    img.classList.add("pin-small", "is-not-reached");
    img.dataset.label = p.name;   // æ¡ˆå†…ç”¨
    img.dataset.km = p.km ?? "";  // è·é›¢ï¼ˆã‚ã‚Œã°ï¼‰
    img.tabIndex = 0;
  } else {
    img.classList.add("pin-large");
  }

  img.style.left = p.x + "%";
  img.style.top = p.y + "%";
  mapWrapper.appendChild(img);

  p._el = img; // å¾Œã§åˆ¶å¾¡ã™ã‚‹ãŸã‚ä¿æŒ
});


// ===== events èª­ã¿è¾¼ã¿ =====
let events = [];

fetch("events.json")
  .then(res => res.json())
  .then(data => {
    events = data.events || [];
    events.forEach(e => e._shown = false);

    renderHistory();   // â† â˜… è¿½åŠ 
  });


// ===== milestones èª­ã¿è¾¼ã¿ =====
let milestones = [];

fetch("milestones.json")
  .then(res => res.json())
  .then(data => {
    milestones = data;
    createMilestones();

    milestones.forEach(m => {
      m._el.classList.remove("active");
    });

    updateEvents(); // â˜… åˆæœŸè¡¨ç¤ºã§å¿…ãšä¸€åº¦åæ˜ 
  });


function calculatePassedPointsPerRow(history, passingPoints) {
  let total = 0;
  const result = [];

  history.forEach(h => {
    const prevTotal = total;
    total += h.km;

    const passedHere = passingPoints
  .filter(p =>
    typeof p.km === "number" &&
    prevTotal < p.km &&
    total >= p.km
  )
  .sort((a, b) => a.km - b.km) // â˜… è¿½åŠ ï¼šè·é›¢é †ä¿è¨¼
  .map(p => p.name);

    result.push(passedHere);
  });

  return result;
}


function getAllPassingPoints() {
  const list = [];

  // events.json
  events.forEach(e => {
    const km = Number(e.distanceKm ?? e.km);
    if (!isNaN(km)) {
      list.push({ name: e.point, km });
    }
  });

  // milestones.json
  milestones.forEach(m => {
    if (typeof m.km === "number") {
      list.push({ name: m.name, km: m.km });
    }
  });

  // é‡è¤‡é™¤å»
  const unique = [];
  const seen = new Set();

  list.forEach(p => {
    const key = `${p.name}@@${p.km}`;
    if (!seen.has(key)) {
      seen.add(key);
      unique.push(p);
    }
  });

  unique.sort((a, b) => a.km - b.km);
  return unique;
}

document.getElementById("saveBtn").addEventListener("click", () => {
  const data = {
    history
  };

  const blob = new Blob(
    [JSON.stringify(data, null, 2)],
    { type: "application/json" }
  );

  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  
const now = new Date();
const y = now.getFullYear();
const m = String(now.getMonth() + 1).padStart(2, "0");
const d = String(now.getDate()).padStart(2, "0");
const hh = String(now.getHours()).padStart(2, "0");
const mm = String(now.getMinutes()).padStart(2, "0");
a.download = `yunomichi_${y}${m}${d}_${hh}${mm}.json`;

  a.click();
  URL.revokeObjectURL(url);
});

document.getElementById("loadBtn").addEventListener("click", () => {
  document.getElementById("loadInput").click();
});

document.getElementById("loadInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    try {
      const data = JSON.parse(reader.result);

      if (!Array.isArray(data.history)) {
        alert("ä¸æ­£ãªãƒ•ã‚¡ã‚¤ãƒ«ã§ã™");
        return;
      }

      history = data.history;
      save();

      events.forEach(e => e._shown = false);

      updateRoute();
      updateGoalPin();
      renderHistory();
      updateEvents();

      alert("å¾©å…ƒã—ã¾ã—ãŸ");
    } catch {
      alert("èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ");
    }
  };
  reader.readAsText(file);
});


// ===== ãƒ˜ãƒ«ãƒ—ï¼ˆï¼Ÿï¼‰ãƒœã‚¿ãƒ³ =====
document.querySelectorAll(".help-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    if (btn.dataset.help === "save") {
      alert(
        "ã“ã®ã‚¢ãƒ—ãƒªã®è¨˜éŒ²ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¸€æ™‚çš„ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚\n" +
        "ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªä¸Šã®è¨˜éŒ²ã¯æ¶ˆãˆã¾ã™ã€‚\n\n" +
        "ã€Œä¿å­˜ã€ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚¹ãƒãƒ›ã«æ®‹ã‚Šã¾ã™ã€‚\n" +
        "å®šæœŸçš„ãªä¿å­˜ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚"
      );
    }

    if (btn.dataset.help === "load") {
      alert(
        "ä¿å­˜ã—ã¦ãŠã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã§ã€\n" +
        "è¨˜éŒ²ã‚’å…ƒã«æˆ»ã™ã“ã¨ï¼ˆå¾©å…ƒï¼‰ãŒã§ãã¾ã™ã€‚\n\n" +
        "èª¤ã£ã¦ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã‚’ã—ãŸå ´åˆã«ä½¿ã„ã¾ã™ã€‚"
      );
    }
  });
});


updateRoute();
updateGoalPin();


function showPointDetail(pointName) {
  const box = document.getElementById("pointDetail");
  if (!box) return;

  const data = POINT_DETAILS[pointName];
  if (!data) return;

  // ===== ä¸­èº« =====
  box.innerHTML = `
    <div class="point-detail-header">
      <strong>${data.title}</strong>
      <button class="point-detail-close" aria-label="é–‰ã˜ã‚‹">Ã—</button>
    </div>
    <img src="${data.img}" class="point-detail-image">
    <div class="point-detail-text">
      ${data.text}
    </div>
  `;

  // ===== è¡¨ç¤ºä½ç½®ï¼ˆå¸¸ã«ä»Šã®ç”»é¢ä¸­å¤®ï¼‰=====
  box.style.left = "50%";
  box.style.top  = `${window.pageYOffset + window.innerHeight / 2}px`;

  box.classList.remove("hidden");
  box.classList.add("show");

  // â˜… å¤–ã‚¿ãƒƒãƒ—åˆ¤å®šã‚’æœ‰åŠ¹åŒ–
  box._outsideReady = false;
  setTimeout(() => {
    box._outsideReady = true;
  }, 0);

  box.querySelector(".point-detail-close")
     .addEventListener("click", hidePointDetail);
}



// ===== ğŸ“· é–‰ã˜ã‚‹ =====
function hidePointDetail() {
  const box = document.getElementById("pointDetail");
  if (!box) return;

  box.classList.remove("show");
  box.classList.add("hidden");
  box._outsideReady = false;
}


// ===== ğŸ“± å¤–ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹ =====
document.addEventListener("click", (e) => {
  const box = document.getElementById("pointDetail");
  if (!box) return;

  // è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ãªã‚‰ä½•ã‚‚ã—ãªã„
  if (!box.classList.contains("show")) return;

  // ğŸ“·ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸç›´å¾Œã¯ç„¡è¦–ï¼ˆâ†æœ€é‡è¦ï¼‰
  if (!box._outsideReady) return;

  // ã‚«ãƒ¼ãƒ‰å†…ã‚¯ãƒªãƒƒã‚¯ã¯ç„¡è¦–
  if (box.contains(e.target)) return;

  hidePointDetail();
}, true); // â† â˜… capture ãƒ•ã‚§ãƒ¼ã‚ºã§å‡¦ç†



</script>

</body>
</html>
